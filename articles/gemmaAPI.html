<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gemma API R Wrapper • gemmaAPI</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Gemma API R Wrapper">
<meta property="og:description" content="gemmaAPI">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=TODO"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'TODO');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gemmaAPI</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/gemmaAPI.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/async.html">Asynchronous Requests (advanced)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/PavlidisLab/Gemma-API/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="gemmaAPI_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Gemma API R Wrapper</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/PavlidisLab/Gemma-API/blob/master/vignettes/gemmaAPI.Rmd"><code>vignettes/gemmaAPI.Rmd</code></a></small>
      <div class="hidden name"><code>gemmaAPI.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://pavlidislab.github.io/Gemma-API/">gemmaAPI</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/Biobase">Biobase</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/memoise">memoise</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/">microbenchmark</a></span><span class="op">)</span></code></pre></div>
<div id="about-gemma" class="section level2">
<h2 class="hasAnchor">
<a href="#about-gemma" class="anchor"></a>About Gemma</h2>
<p><a href="https://gemma.ubc.msl.ca/">Gemma</a> is a web site, database and a set of tools for the meta-analysis, re-use and sharing of genomics data, currently primarily targeted at the analysis of gene expression profiles. Gemma contains data from thousands of public studies, referencing thousands of published papers. Every dataset in Gemma has passed a rigorous curation process that re-annotates the expression platform at the sequence level, which allows for more consistent cross-platform comparisons and meta-analyses.</p>
<p>For detailed information on the curation process, check this <a href="https://pavlidislab.github.io/Gemma/curation.html">page</a> or the latest <a href="https://academic.oup.com/database/article/doi/10.1093/database/baab006/6143045">publication</a>.</p>
</div>
<div id="using-the-gemma-api-r-wrapper" class="section level2">
<h2 class="hasAnchor">
<a href="#using-the-gemma-api-r-wrapper" class="anchor"></a>Using the Gemma API R Wrapper</h2>
<p>The Gemma API wrapper is very straightforward to use and contains a function for each entry in the REST API docs, <a href="https://gemma.msl.ubc.ca/resources/restapidocs/">here</a>. We suggest you make some example queries on the interactive API docs to get a sense of the endpoints and their inputs and outputs.</p>
<p>The main goal of this wrapper is giving easy access to Gemma’s curated dataset for downstream or meta-analyses.In this example, we want to find the dataset with the highest <a href="https://pavlidislab.github.io/Gemma/geeq.html">Gemma Quality Score</a> that is associated with bipolar disorder, and we are only interested in human data. To do this, we can use the <a href="https://pavlidislab.github.io/Gemma-API/reference/searchDatasets.html"><code>searchDatasets()</code></a> endpoint:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/searchDatasets.html">searchDatasets</a></span><span class="op">(</span><span class="st">"bipolar"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">taxon.Name</span> <span class="op">==</span> <span class="st">"human"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">geeq.qScore</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ee.ShortName</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt;    ee.ShortName
#&gt; 1:     GSE35974
#&gt; 2:     GSE12649
#&gt; 3:     GSE99349
#&gt; 4:     GSE11767
#&gt; 5:     GSE12654
#&gt; 6:     GSE74358</code></pre>
<p>The dataset with the highest quality score is <a href="https://gemma.msl.ubc.ca/expressionExperiment/showExpressionExperiment.html?id=5939">GSE35974</a>. Now that we have the ID for our experiment, we can fetch the data associated with it.</p>
<p>To get the basic information of a dataset, we use the <a href="https://pavlidislab.github.io/Gemma-API/reference/getDatasets.html"><code>getDatasets()</code></a> endpoint.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDatasets.html">getDatasets</a></span><span class="op">(</span><span class="st">"GSE35974"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt;  [1] "ee.ShortName"        "ee.Name"             "ee.ID"               "ee.Description"      "ee.Public"           "ee.Troubled"        
#&gt;  [7] "ee.Accession"        "ee.Database"         "ee.URL"              "ee.Samples"          "ee.LastUpdated"      "ee.Batch.P"         
#&gt; [13] "ee.Batch.PC"         "geeq.batchCorrected" "geeq.qScore"         "geeq.sScore"         "taxon.Name"          "taxon.ID"           
#&gt; [19] "technology.Type"</code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataset</span><span class="op">$</span><span class="va">ee.Description</span></code></pre></div>
<pre><code>#&gt; [1] "Background: Schizophrenia (SCZ) and bipolar disorder (BD) are highly heritable psychiatric disorders. Associated genetic and gene expression changes have been identified, but many have not been replicated and have unknown functions. We identified groups of genes whose expressions varied together, that is co-expression modules, then tested them for association with SCZ. Using weighted gene co-expression network analysis, we show that two modules were differentially expressed in patients versus controls. One, upregulated in cerebral cortex, was enriched with neuron differentiation and neuron development genes, as well as disease genome-wide association study genetic signals; the second, altered in cerebral cortex and cerebellum, was enriched with genes involved in neuron protection functions. The findings were preserved in five expression data sets, including sets from three brain\nregions, from a different microarray platform, and from BD patients. From those observations, we propose neuron differentiation and development pathways may be involved in etiologies of both SCZ and BD, and neuron protection function participates in pathological process of the diseases.\nLast Updated (by provider): Jul 26, 2018\nContributors:  Chao Chen Chunyu Liu Lijun Cheng"</code></pre>
<p>To access the actual expression data, you can use <a href="https://pavlidislab.github.io/Gemma-API/reference/getBioconductor.html"><code>getBioconductor()</code></a>. It is a high-level wrapper that combines various endpoints to return an annotated <a href="https://bioconductor.org/packages/release/bioc/vignettes/SummarizedExperiment/inst/doc/SummarizedExperiment.html"><code>SummarizedExperiment</code></a> or <a href="https://bioconductor.org/packages/release/bioc/vignettes/Biobase/inst/doc/ExpressionSetIntroduction.pdf"><code>ExpressionSet</code></a> of the queried dataset that is compatible with other Bioconductor packages for downstream analyses. They include the expression matrix along with the experimental design, and ensure the sample names match between both when transforming/subsetting data.</p>
<p>Since this dataset also contains patients with schizophrenia and depression, and we’re only interested in bipolar patients, we can remove those samples. We’re also keeping the <code>reference_subject_role</code>s, which refers to the control samples in Gemma datasets.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create ExpressionSet</span>
<span class="va">eset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getBioconductor.html">getBioconductor</a></span><span class="op">(</span><span class="st">"ExpressionSet"</span>, <span class="st">"GSE35974"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Error: Please specify valid identifiers for dataset and do not combine different types of identifiers.</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">eset</span></code></pre></div>
<pre><code>#&gt; ExpressionSet (storageMode: lockedEnvironment)
#&gt; assayData: 21939 features, 144 samples 
#&gt;   element names: exprs 
#&gt; protocolData: none
#&gt; phenoData
#&gt;   sampleNames: DE59_111109_rep1 DE60_100909 ... AC101_100909 (144 total)
#&gt;   varLabels: DiseaseState batch
#&gt;   varMetadata: labelDescription
#&gt; featureData: none
#&gt; experimentData: use 'experimentData(object)'
#&gt; Annotation: GPL6244</code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Check the levels of the DiseaseState cofactor</span>
<span class="va">eset</span><span class="op">$</span><span class="va">DiseaseState</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] "reference_subject_role" "mental_depression"      "Bipolar_Disorder"       "schizophrenia"</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Subset patients with bipolar disorder and controls.</span>
<span class="va">bipolar</span> <span class="op">&lt;-</span> <span class="va">eset</span><span class="op">[</span> , <span class="va">eset</span><span class="op">$</span><span class="va">DiseaseState</span> <span class="op">==</span> <span class="st">"Bipolar_Disorder"</span> <span class="op">|</span> <span class="va">eset</span><span class="op">$</span><span class="va">DiseaseState</span> <span class="op">==</span> <span class="st">"reference_subject_role"</span><span class="op">]</span>
<span class="va">bipolar</span></code></pre></div>
<pre><code>#&gt; ExpressionSet (storageMode: lockedEnvironment)
#&gt; assayData: 21939 features, 87 samples 
#&gt;   element names: exprs 
#&gt; protocolData: none
#&gt; phenoData
#&gt;   sampleNames: DE59_111109_rep1 DE7_111109 ... AC1_100909 (87 total)
#&gt;   varLabels: DiseaseState batch
#&gt;   varMetadata: labelDescription
#&gt; featureData: none
#&gt; experimentData: use 'experimentData(object)'
#&gt; Annotation: GPL6244</code></pre>
<p>Let’s check the expression for every sample to make sure they look OK:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get Expression matrix</span>
<span class="va">bipExpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html">exprs</a></span><span class="op">(</span><span class="va">bipolar</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">bipExpr</span>, pch<span class="op">=</span><span class="st">"."</span>, xaxt<span class="op">=</span><span class="st">"n'"</span>, xlab<span class="op">=</span><span class="st">"Sample"</span>, ylab<span class="op">=</span><span class="st">"Expression"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/base-boxplot-1.png" alt=""><p class="caption">plot of chunk base-boxplot</p>
</div>
<p>We can quickly see three samples among bipolar patients and controls are empty. This is because during the curation process Gemma flags potential outlier samples automatically, which are then manually reviewed. Samples confirmed to be outliers are represented as missing data to ensure transparency.</p>
<p>From this point on, you can use <a href="https://bioconductor.org/packages/release/bioc/html/limma.html"><code>limma</code></a> or other alternatives in Bioconductor to compare the gene expression of bipolar patients with healthy controls and determine which genes showed the most significant changes.</p>
<div id="tidyverse-compatibility" class="section level3">
<h3 class="hasAnchor">
<a href="#tidyverse-compatibility" class="anchor"></a>Tidyverse compatibility</h3>
<p>We included another wrapper, <a href="https://pavlidislab.github.io/Gemma-API/reference/getTidyDataset.html"><code>getTidyDataset()</code></a> to get data in a “long” format that also combines the design and expression matrices and ensures they always match. This format allows visualization with the popular <a href="https://ggplot2.tidyverse.org/">ggplot2</a> package and is compatible with the rest of the <a href="https://www.tidyverse.org/">tidyverse</a>. It also combines the design and expression matrices and ensures they always match.</p>
<p>This is the same workflow as above, now working with tidy data:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tidy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getTidyDataset.html">getTidyDataset</a></span><span class="op">(</span><span class="st">"GSE35974"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">DiseaseState</span> <span class="op">==</span> <span class="st">'Bipolar_Disorder'</span> <span class="op">|</span> <span class="va">DiseaseState</span> <span class="op">==</span> <span class="st">'reference_subject_role'</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Error: Please specify one valid identifier for dataset.</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot distribution of expression data by sample</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tidy</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sample</span>, <span class="va">Expression</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Warning: Removed 99756 rows containing non-finite values (stat_boxplot).</code></pre>
<div class="figure">
<img src="figure/ggplot-boxplot-1.png" alt=""><p class="caption">plot of chunk ggplot-boxplot</p>
</div>
</div>
</div>
<div id="complex-queries" class="section level2">
<h2 class="hasAnchor">
<a href="#complex-queries" class="anchor"></a>Complex queries</h2>
<p>Many endpoints also allow you to query multiple objects at the same time. For example, getting information on the top 3 datasets associated with bipolar disorder.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/getDatasets.html">getDatasets</a></span><span class="op">(</span>datasets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'GSE35974'</span>, <span class="st">'GSE12649'</span>, <span class="st">'GSE99349'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Rows: 3
#&gt; Columns: 19
#&gt; $ ee.ShortName        [3m[38;5;246m&lt;chr&gt;[39m[23m "GSE12649", "GSE35974", "GSE99349"
#&gt; $ ee.Name             [3m[38;5;246m&lt;chr&gt;[39m[23m "Gene expression from human prefrontal cortex (BA46)", "Expression data from the human cerebellum brain", "Gene Network Dysr…
#&gt; $ ee.ID               [3m[38;5;246m&lt;int&gt;[39m[23m 1205, 5939, 11690
#&gt; $ ee.Description      [3m[38;5;246m&lt;chr&gt;[39m[23m "Accumulating evidence suggests that mitochondrial dysfunction underlies the pathophysiology of bipolar disorder (BD) and sc…
#&gt; $ ee.Public           [3m[38;5;246m&lt;lgl&gt;[39m[23m TRUE, TRUE, TRUE
#&gt; $ ee.Troubled         [3m[38;5;246m&lt;lgl&gt;[39m[23m FALSE, FALSE, FALSE
#&gt; $ ee.Accession        [3m[38;5;246m&lt;chr&gt;[39m[23m "GSE12649", "GSE35974", "GSE99349"
#&gt; $ ee.Database         [3m[38;5;246m&lt;chr&gt;[39m[23m "GEO", "GEO", "GEO"
#&gt; $ ee.URL              [3m[38;5;246m&lt;chr&gt;[39m[23m "http://www.ncbi.nlm.nih.gov/geo/", "http://www.ncbi.nlm.nih.gov/geo/", "http://www.ncbi.nlm.nih.gov/geo/"
#&gt; $ ee.Samples          [3m[38;5;246m&lt;int&gt;[39m[23m 102, 144, 36
#&gt; $ ee.LastUpdated      [3m[38;5;246m&lt;dttm&gt;[39m[23m 2021-01-13 16:08:05, 2020-03-28 04:23:35, 2020-03-29 21:16:16
#&gt; $ ee.Batch.P          [3m[38;5;246m&lt;dbl&gt;[39m[23m NA, NA, NA
#&gt; $ ee.Batch.PC         [3m[38;5;246m&lt;dbl&gt;[39m[23m NA, NA, NA
#&gt; $ geeq.batchCorrected [3m[38;5;246m&lt;lgl&gt;[39m[23m FALSE, TRUE, FALSE
#&gt; $ geeq.qScore         [3m[38;5;246m&lt;dbl&gt;[39m[23m 0.9972712, 0.9975938, 0.9879754
#&gt; $ geeq.sScore         [3m[38;5;246m&lt;dbl&gt;[39m[23m 0.875, 1.000, 1.000
#&gt; $ taxon.Name          [3m[38;5;246m&lt;chr&gt;[39m[23m "human", "human", "human"
#&gt; $ taxon.ID            [3m[38;5;246m&lt;int&gt;[39m[23m 1, 1, 1
#&gt; $ technology.Type     [3m[38;5;246m&lt;chr&gt;[39m[23m "ONECOLOR", "ONECOLOR", "GENELIST"</code></pre>
<p>You’ll be able to tell which endpoints accept multiple inputs from the function examples or simply because the the parameter name is plural in the documentation. The rest of the endpoints only support a single identifier:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/getDatasetAnnotations.html">getDatasetAnnotations</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'GSE35974'</span>, <span class="st">'GSE12649'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Error: Please specify one valid identifier for dataset.</code></pre>
<p>In these cases, you will have to loop over all the identifiers you wish to query and send separate requests.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'GSE35974'</span>, <span class="st">'GSE12649'</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="../reference/getDatasetAnnotations.html">getDatasetAnnotations</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>shortName <span class="op">=</span> <span class="va">dataset</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">rbindlist</span></code></pre></div>
<pre><code>#&gt; Error: Please specify one valid identifier for dataset.</code></pre>
<div id="asynchronous-requests" class="section level3">
<h3 class="hasAnchor">
<a href="#asynchronous-requests" class="anchor"></a>Asynchronous requests</h3>
<p>For very large requests, this is often insufficient and instead, we recommend using asynchronous requests, which are explained in the <a href="https://pavlidislab.github.io/Gemma-API/articles/async.html">async vignette</a>.</p>
</div>
<div id="memoised-data" class="section level3">
<h3 class="hasAnchor">
<a href="#memoised-data" class="anchor"></a>Memoised data</h3>
<p>A different way to speed up requests (in a way) is to remember past results so future queries can proceed virtually instantly. This is enabled through the <a href="https://github.com/r-lib/memoise"><code>memoise</code></a> package. To enable memoisation, simply set <code>memoised = T</code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/getDatasetData.html">getDatasetData</a></span><span class="op">(</span><span class="st">'GSE35974'</span>, memoised <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, unit <span class="op">=</span> <span class="st">'ms'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="42%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">expr</th>
<th align="right">min</th>
<th align="right">lq</th>
<th align="right">mean</th>
<th align="right">median</th>
<th align="right">uq</th>
<th align="right">max</th>
<th align="right">neval</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">getDatasetData(“GSE35974”, memoised = TRUE)</td>
<td align="right">41776.12</td>
<td align="right">41776.12</td>
<td align="right">41776.12</td>
<td align="right">41776.12</td>
<td align="right">41776.12</td>
<td align="right">41776.12</td>
<td align="right">1</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/getDatasetData.html">getDatasetData</a></span><span class="op">(</span><span class="st">'GSE35974'</span>, memoised <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, unit <span class="op">=</span> <span class="st">'ms'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="42%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">expr</th>
<th align="right">min</th>
<th align="right">lq</th>
<th align="right">mean</th>
<th align="right">median</th>
<th align="right">uq</th>
<th align="right">max</th>
<th align="right">neval</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">getDatasetData(“GSE35974”, memoised = TRUE)</td>
<td align="right">0.428396</td>
<td align="right">0.428396</td>
<td align="right">0.428396</td>
<td align="right">0.428396</td>
<td align="right">0.428396</td>
<td align="right">0.428396</td>
<td align="right">1</td>
</tr></tbody>
</table>
<p>If you’re done with your fetching and want to ensure no space is being used for cached results, or if you just want to ensure you’re getting up-to-date data from Gemma, you can clear the cache using <code>forgetGemmaMemoised</code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/forgetGemmaMemoised.html">forgetGemmaMemoised</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
</div>
<div id="output-options" class="section level2">
<h2 class="hasAnchor">
<a href="#output-options" class="anchor"></a>Output options</h2>
<div id="raw-data" class="section level3">
<h3 class="hasAnchor">
<a href="#raw-data" class="anchor"></a>Raw data</h3>
<p>By default, Gemma API does some parsing on the raw API results to make it easier to work with inside of R. In the process, it drops some typically unused values. Sometimes, you may wish to to get access to everything, unadulterated by the Gemma API wrapper. This is enabled by setting <code>raw = T</code>. Instead of a <code>data.table</code>, you’ll be served (typically) a list that represents the underlying JSON response.</p>
</div>
<div id="file-outputs" class="section level3">
<h3 class="hasAnchor">
<a href="#file-outputs" class="anchor"></a>File outputs</h3>
<p>Sometimes, you may wish to save results to a file for future inspection. You can do this simply by providing a filename to <code>file</code>. The extension for this file will be one of three options:</p>
<ol style="list-style-type: decimal">
<li>
<code>.json</code>, if you requested results with <code>raw = TRUE</code>
</li>
<li>
<code>.csv</code> if the results have no nested <code>data.table</code>s</li>
<li>
<code>.rds</code> otherwise</li>
</ol>
<p>You can also specify whether or not the new fetched results are allowed to overwrite an existing file by specifying the <code>overwrite</code> parameter.</p>
<p>To illustrate these…</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="fu"><a href="../reference/getDatasetSVD.html">getDatasetSVD</a></span><span class="op">(</span><span class="st">'GSE35974'</span>, raw <span class="op">=</span> <span class="cn">TRUE</span>, file <span class="op">=</span> <span class="st">'SVD'</span><span class="op">)</span><span class="op">)</span> <span class="co"># raw = T, saves SVD.json</span></code></pre></div>
<pre><code>#&gt; List of 3
#&gt;  $ bioMaterialIds: int [1:144] 203828 203846 203939 203908 203818 203944 203861 203827 203946 203817 ...
#&gt;  $ variances     : num [1:144] 0.0685 0.0437 0.0373 0.0287 0.0263 ...
#&gt;  $ vMatrix       :List of 4
#&gt;   ..$ colNames          : int [1:5] 0 1 2 3 4
#&gt;   ..$ rowNames          : int [1:144] 203828 203846 203939 203908 203818 203944 203861 203827 203946 203817 ...
#&gt;   ..$ rawMatrix         : num [1:144, 1:5] 0.0509 -0.011 0.139 -0.0619 0.1197 ...
#&gt;   ..$ rowNameMapIterator: int [1:144] 203828 203846 203939 203908 203818 203944 203861 203827 203946 203817 ...</code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="fu"><a href="../reference/getDatasetPlatforms.html">getDatasetPlatforms</a></span><span class="op">(</span><span class="st">'GSE35974'</span>, file <span class="op">=</span> <span class="st">'platforms'</span><span class="op">)</span><span class="op">)</span> <span class="co"># No nested data.tables, saves platforms.csv</span></code></pre></div>
<pre><code>#&gt; Rows: 1
#&gt; Columns: 15
#&gt; $ platform.ID                  [3m[38;5;246m&lt;int&gt;[39m[23m 380
#&gt; $ platform.ShortName           [3m[38;5;246m&lt;chr&gt;[39m[23m "GPL6244"
#&gt; $ platform.Name                [3m[38;5;246m&lt;chr&gt;[39m[23m "Affymetrix Human Gene 1.0 ST Array"
#&gt; $ platform.Description         [3m[38;5;246m&lt;chr&gt;[39m[23m " Probe set data extracted from HuGene-1_0-st-v1.r3.pgf  #%pgf_format_version=1.0 #%chip_type=HuGene-1_0-st-v1 #%li…
#&gt; $ platform.Troubled            [3m[38;5;246m&lt;lgl&gt;[39m[23m FALSE
#&gt; $ platform.ExperimentCount     [3m[38;5;246m&lt;int&gt;[39m[23m 338
#&gt; $ platform.GeneCount           [3m[38;5;246m&lt;lgl&gt;[39m[23m NA
#&gt; $ platform.ProbeSequenceCount  [3m[38;5;246m&lt;lgl&gt;[39m[23m NA
#&gt; $ platform.ProbeAlignmentCount [3m[38;5;246m&lt;lgl&gt;[39m[23m NA
#&gt; $ platform.ProbeGeneCount      [3m[38;5;246m&lt;lgl&gt;[39m[23m NA
#&gt; $ platform.ElementCount        [3m[38;5;246m&lt;lgl&gt;[39m[23m NA
#&gt; $ taxon.Name                   [3m[38;5;246m&lt;chr&gt;[39m[23m "human"
#&gt; $ taxon.ID                     [3m[38;5;246m&lt;lgl&gt;[39m[23m NA
#&gt; $ technology.Type              [3m[38;5;246m&lt;chr&gt;[39m[23m "ONECOLOR"
#&gt; $ technology.Color             [3m[38;5;246m&lt;chr&gt;[39m[23m "ONECOLOR"</code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="fu"><a href="../reference/getDatasetSamples.html">getDatasetSamples</a></span><span class="op">(</span><span class="st">'GSE35974'</span>, file <span class="op">=</span> <span class="st">'samples'</span><span class="op">)</span><span class="op">)</span> <span class="co"># Some nested data.tables, saves samples.rds</span></code></pre></div>
<pre><code>#&gt; Rows: 144
#&gt; Columns: 17
#&gt; $ bioMaterial.Name       [3m[38;5;246m&lt;chr&gt;[39m[23m "GSE35974_Biomat_123", "GSE35974_Biomat_63", "GSE35974_Biomat_5", "GSE35974_Biomat_41", "GSE35974_Biomat_124", "GSE35974_…
#&gt; $ sample.Name            [3m[38;5;246m&lt;chr&gt;[39m[23m "DE15_102109", "AC52_103009", "AC60_111809", "DE22_102309", "AC10_100909", "AC12_102109", "AC68_102309_rep1", "AC21_10230…
#&gt; $ sample.ID              [3m[38;5;246m&lt;int&gt;[39m[23m 203849, 203902, 203893, 203840, 203946, 203937, 203884, 203928, 203831, 203875, 203822, 203813, 203919, 203866, 203857, 2…
#&gt; $ sample.Correspondence  [3m[38;5;246m&lt;chr&gt;[39m[23m "BioMat:,GSM878312 on GPL6244", "BioMat:,GSM878259 on GPL6244", "BioMat:,GSM878268 on GPL6244", "BioMat:,GSM878321 on GPL…
#&gt; $ sample.Description     [3m[38;5;246m&lt;chr&gt;[39m[23m " DE15\nSource GEO sample is GSM878312\nLast updated (according to GEO): Dec 31 2012", " AC52\nSource GEO sample is GSM87…
#&gt; $ sample.Outlier         [3m[38;5;246m&lt;lgl&gt;[39m[23m FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…
#&gt; $ sample.Accession       [3m[38;5;246m&lt;chr&gt;[39m[23m "GSM878312", "GSM878259", "GSM878268", "GSM878321", "GSM878215", "GSM878224", "GSM878277", "GSM878233", "GSM878330", "GSM…
#&gt; $ sample.Processed       [3m[38;5;246m&lt;dbl&gt;[39m[23m 1.256175e+12, 1.256945e+12, 1.258597e+12, 1.256341e+12, 1.255129e+12, 1.256173e+12, 1.256348e+12, 1.256345e+12, 1.255140e…
#&gt; $ sample.Characteristics [3m[38;5;246m&lt;list&gt;[39m[23m [&lt;data.table[9 x 4]&gt;], [&lt;data.table[9 x 4]&gt;], [&lt;data.table[9 x 4]&gt;], [&lt;data.table[9 x 4]&gt;], [&lt;data.table[9 x 4]&gt;], [&lt;dat…
#&gt; $ sample.FactorValues    [3m[38;5;246m&lt;list&gt;[39m[23m [&lt;data.table[2 x 4]&gt;], [&lt;data.table[2 x 4]&gt;], [&lt;data.table[2 x 4]&gt;], [&lt;data.table[2 x 4]&gt;], [&lt;data.table[2 x 4]&gt;], [&lt;dat…
#&gt; $ array.ShortName        [3m[38;5;246m&lt;chr&gt;[39m[23m "GPL6244", "GPL6244", "GPL6244", "GPL6244", "GPL6244", "GPL6244", "GPL6244", "GPL6244", "GPL6244", "GPL6244", "GPL6244", …
#&gt; $ array.Name             [3m[38;5;246m&lt;chr&gt;[39m[23m "Affymetrix Human Gene 1.0 ST Array", "Affymetrix Human Gene 1.0 ST Array", "Affymetrix Human Gene 1.0 ST Array", "Affyme…
#&gt; $ array.Taxon            [3m[38;5;246m&lt;lgl&gt;[39m[23m NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
#&gt; $ array.TaxonID          [3m[38;5;246m&lt;lgl&gt;[39m[23m NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
#&gt; $ array.Type             [3m[38;5;246m&lt;lgl&gt;[39m[23m NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
#&gt; $ array.Description      [3m[38;5;246m&lt;lgl&gt;[39m[23m NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
#&gt; $ array.Troubled         [3m[38;5;246m&lt;lgl&gt;[39m[23m FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA…</code></pre>
</div>
<div id="changing-defaults" class="section level3">
<h3 class="hasAnchor">
<a href="#changing-defaults" class="anchor"></a>Changing defaults</h3>
<p>We’ve seen how to change <code>async = T</code>, <code>memoised = T</code>, <code>overwrite = T</code> and <code>raw = T</code>… It’s possible that you want to always use the functions these ways without specifying the option every time. You can do this by simply changing the default, which is visible in the function definition. For example, if you want to memoise results by default, you can use:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>gemma.memoise <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="authentication" class="section level2">
<h2 class="hasAnchor">
<a href="#authentication" class="anchor"></a>Authentication</h2>
<p>If you have an account at <a href="https://gemma.msl.ubc.ca">Gemma</a> and want to access data that is private, you can login using <code><a href="../reference/setGemmaUser.html">setGemmaUser("USERNAME", "PASSWORD")</a></code>. These will be passed on to every API request you make until you log out (by calling <code><a href="../reference/setGemmaUser.html">setGemmaUser()</a></code>).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jordan Sicherman, Ogan Mancarci, Javier Castillo-Arnemann.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
